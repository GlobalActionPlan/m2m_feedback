<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
metal:use-macro="view.macro(view.main_tpl)"
i18n:domain="arche_m2m">
    <div metal:fill-slot="content">
        <p>&nbsp;</p>
        <div class="row" tal:condition="not view.show_manager_controls">
            <div class="col-m2-12">
                <div class="progress" tal:define="(completed, current) view.calc_percentages()">
                    <div class="progress-bar progress-bar-success" style="width: ${completed}%"></div>
                    <div class="progress-bar progress-bar-warning progress-bar-striped" style="width: ${current}%"></div>
                </div>
            </div>
        </div>

        <!-- manager section -->
        <div class="row" tal:condition="view.show_manager_controls">
            <div class="col-md-12">
                <h3 i18n:translate="">Thresholds</h3>
                    Max score: ${view.max_score}
                    Participant score: ${view.participant_score|''}
                    Ruleset: <a href="${request.resource_url(view.ruleset)}">${view.ruleset.title}</a>

                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th i18n:translate="">Title</th>
                            <th i18n:translate="">Percentage</th>
                            <th i18n:translate="">Colour</th>
                            <th i18n:translate="">Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr tal:repeat="obj view.get_thresholds()">
                            <td>
                                <a href="${request.resource_url(obj)}">${obj.title}</a>
                            </td>
                            <td>${obj.percentage}</td>
                            <td>
                                <code class="badge" style="background-color: #${obj.colour};">
                                    ${obj.colour}
                                </code>
                            </td>
                            <td>${obj.description}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- manager -->

        <div class="row">
            <h1>
                Result of the section ${view.section.title}
            </h1>
            <p>&nbsp;</p>
            <p>&nbsp;</p>

            <div class="container-fluid">

                <tal:def define="threshold view.get_relevant_threshold()">
                    <div class="row">
                        <div class="progress2 " tal:define="percentage '{0:.0f}%'.format(view.get_percentage(view.participant_score));
                            hex_colour getattr(threshold, 'colour', 'cccccc');">
                            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
                                style="min-width: 2em; width: ${percentage}; background-color: #${hex_colour};">
                                    ${percentage}
                            </div>
                        </div>
                        <p>&nbsp;</p>
                        <div class="col-sm-2">
                            <p>
                                Your score
                            </p>
                            <span class="number" id="participant_score" tal:define="hex_colour getattr(threshold, 'colour', 'cccccc');" style="color : #${hex_colour}">${view.participant_score}</span>
                        </div>
                        <div class="col-sm-2">
                            <p>
                                Max score
                            </p>
                            <span class="number" id="max_score">  ${view.max_score}</span>
                        </div>
                    </div>
                    <div class="row">
                        <p>&nbsp;</p>
                        <tal:threshold condition="threshold">
                            <h2>${threshold.title}</h2>
                            <p>&nbsp;</p>
                            <p>${threshold.description}</p>
                        </tal:threshold>
                        <tal:no_info condition="not threshold">
                            No info related to this threshold level
                        </tal:no_info>
                    </div>
                </tal:def>
                <div id="pict" tal:condition="view.participant_score == view.max_score">
                    <image src="${request.static_url('m2m_feedback:static/images/smiley.png')}"/>
                </div>
            </div>
        </div>

        <p>&nbsp;</p>

        <div class="row list">
            <div class="col-md-6">
                <h2><span id="best"></span> Best answers</h2>

                <ol>
                    <li tal:repeat="res view.get_sort_by_hq(view.get_questions(),False)">
                        ${res[0].title} ${res[1]} ${res[2]}
                    </li>

                </ol>
            </div>
            <div class="col-md-6">
                <h2><span  id="worst"></span >What you can improve</h2>
                <ol>
                    <li tal:repeat="res view.get_sort_by_hq(view.get_questions(),True)">
                        ${res[0].title} ${res[1]} ${res[2]}
                    </li>
                </ol>
            </div>
        </div>

        <p>&nbsp;</p>

        <form tal:replace="structure form" />

            <script type="text/javascript">
                participant_score=$(this).attr('participant_score');
                max_score=$(this).attr('max_score');
                    if ($(max_score).html() > $(participant_score).html())
                {
                    document.getElementById('picture').src='smiley.jpg';
                }
            </script>

            <script type="text/javascript">
                $(document).ready(function()
                {
                    $("form input").keypress(function (e)
                    {
                        if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13))
                        {
                            $('button.submit-default').click();
                            return false;
                        }
                        else
                        {
                            return true;
                        }
                    });
                });
            </script>
        <form tal:replace="structure form" />
    </div>
</html>
